<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Levofloxacin Adult & Pediatric Dosing Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

<style>
/* ---------------- BASIC DESIGN SYSTEM (unchanged from original) --------------- */
:root {
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  line-height: 1.4;
}
body { margin: 0; background:#f5f6f8; color:#222; }
header { background:#0b4f6c; color:#fff; padding:1rem 1.5rem; }
header h1 { margin:0; font-size:1.3rem; }
main { max-width:1250px; margin:1.5rem auto; padding:0 1rem; }
.card {
  background:#fff; border-radius:10px; padding:1rem 1.1rem 1.2rem;
  box-shadow:0 1px 4px rgba(0,0,0,0.08);
}
h2 { margin:0 0 0.5rem; font-size:1.05rem; color:#0b4f6c; }
.field { display:flex; flex-direction:column; margin-bottom:0.6rem; }
input, select, textarea {
  padding:0.35rem 0.45rem; font-size:0.9rem; border-radius:4px;
  border:1px solid #ccd1d9; width:100%; box-sizing:border-box;
}
button {
  border-radius:4px; padding:0.45rem 0.9rem; font-size:0.9rem;
  border:none; cursor:pointer; background:#0b4f6c; color:#fff;
}
button.secondary { background:#e0e3ea; color:#222; }

/* ---------------- NEW PEDIATRIC DESIGN ------------------ */
#pediatricCard {
  display:none;
  border-top:4px solid #c62828;
}
.ped-warning {
  background:#fdecea;
  border-left:4px solid #c62828;
  padding:0.6rem 0.8rem;
  margin-bottom:1rem;
  color:#8a1c1c;
  font-weight:600;
}
.disabled-panel {
  display:none;
  background:#f0f0f0;
  padding:1rem;
  border-radius:8px;
  margin-top:0.5rem;
  border:1px solid #ccc;
  opacity:0.65;
  pointer-events:none;
}
.show-btn {
  margin-top:0.6rem;
  background:#777;
}
</style>
</head>

<body>
<header>
  <h1>Levofloxacin Adult & Pediatric Dosing Calculator</h1>
</header>

<main>

<!-- ======================= PATIENT GENERAL DATA ======================= -->
<section class="card">
  <h2>Patient Data</h2>

  <div class="field">
    <label>Age (years)</label>
    <input type="number" id="age" min="1" max="120">
  </div>

  <div class="field">
    <label>Sex</label>
    <select id="sex">
      <option value="">Select…</option>
      <option value="M">Male</option>
      <option value="F">Female</option>
    </select>
  </div>

  <div class="field">
    <label>Weight (kg)</label>
    <input type="number" id="tbw" step="0.1">
  </div>

  <div class="field">
    <label>Height (cm)</label>
    <input type="number" id="height" step="0.5">
  </div>

  <div class="field">
    <label>Serum Creatinine (mg/dL)</label>
    <input type="number" id="scr" step="0.01">
  </div>

</section>

<!-- ======================= PEDIATRIC MODULE (AGE <16) ======================= -->
<section class="card" id="pediatricCard">

  <div class="ped-warning">
    Levofloxacin is generally NOT recommended for patients under 16 years except for
    FDA-approved indications (post-exposure inhalational anthrax or plague) or when
    no safe alternatives exist.
  </div>

  <h2>Pediatric Levofloxacin Dosing</h2>

  <div class="field">
    <label>Pediatric Indication</label>
    <select id="pedInd">
      <option value="">Select indication…</option>
      <option value="anthrax">Post-exposure inhalational anthrax</option>
      <option value="plague">Pneumonic / septicemic plague</option>
      <option value="override">Clinician override – no safer alternative</option>
    </select>
  </div>

  <div class="field">
    <label>Clinician justification (required for override)</label>
    <textarea id="pedJustification"></textarea>
  </div>

  <div class="field">
    <button id="pedCalcBtn">Calculate Pediatric Dose</button>
  </div>

  <hr>

  <h2>Pediatric Output</h2>

  <div class="field"><strong>Dose per administration:</strong> <span id="pedDoseOut">–</span></div>
  <div class="field"><strong>Interval:</strong> <span id="pedIntOut">–</span></div>
  <div class="field"><strong>Duration:</strong> <span id="pedDurOut">–</span></div>

  <h3>PK Estimates</h3>
  <div class="field"><strong>Vd:</strong> <span id="pedVdOut">–</span></div>
  <div class="field"><strong>CL:</strong> <span id="pedClOut">–</span></div>
  <div class="field"><strong>ke:</strong> <span id="pedKeOut">–</span></div>
  <div class="field"><strong>t½:</strong> <span id="pedThalfOut">–</span></div>

  <div class="field"><strong>Predicted Cmax:</strong> <span id="pedCmaxOut">–</span></div>
  <div class="field"><strong>Predicted Cmin:</strong> <span id="pedCminOut">–</span></div>

  <hr>

  <h2>Summary</h2>
  <pre id="pedSummaryText">Enter pediatric details and calculate.</pre>

  <button class="show-btn" id="showAdultBtn">Show Adult Regimens (disabled)</button>
  <div id="adultDisabledPanel" class="disabled-panel">
    <h3>Adult Regimens (Reference Only – Disabled)</h3>
    <p>Adult dosing is disabled because patient is under 16 years.</p>
    <p>All adult indications and renal adjustments appear here for reference only.</p>
  </div>

</section>

<!-- ======================= ADULT MODULE (STANDARD) ======================= -->
<section id="adultMain" class="card">
  <h2>Adult Dosing Module</h2>
  <p>This entire module is hidden when age <16.</p>

  <div class="field">
    <label>Indication</label>
    <select id="indication">
      <option value="CAP_750">Community-acquired pneumonia (750 mg)</option>
      <option value="CAP_500">Community-acquired pneumonia (500 mg)</option>
      <option value="HAP">HAP/VAP</option>
      <option value="UTI750">Complicated UTI (750 mg)</option>
      <option value="UTI250">Complicated UTI (250 mg)</option>
      <option value="OTH">Other</option>
    </select>
  </div>

  <div class="field">
    <button id="adultCalcBtn">Calculate Adult Dose</button>
  </div>

  <div class="field"><strong>Adult Output:</strong> <span id="adultOut">–</span></div>
</section>

</main>

<script>
/* =================== Utility =================== */
function round25(x) {
  if (!x) return 0;
  return Math.round(x / 25) * 25;
}

/* =================== Mode Switcher =================== */
const ageInput = document.getElementById("age");
ageInput.addEventListener("input", () => {
  const age = parseFloat(ageInput.value);

  if (age < 16) {
    document.getElementById("adultMain").style.display = "none";
    document.getElementById("pediatricCard").style.display = "block";
  } else {
    document.getElementById("adultMain").style.display = "block";
    document.getElementById("pediatricCard").style.display = "none";
  }
});

/* =================== Adult Reference Collapsible Panel =================== */
document.getElementById("showAdultBtn").addEventListener("click", () => {
  const panel = document.getElementById("adultDisabledPanel");
  panel.style.display = panel.style.display === "block" ? "none" : "block";
});

/* =================== Pediatric Calculation =================== */
document.getElementById("pedCalcBtn").addEventListener("click", () => {

  const w = parseFloat(document.getElementById("tbw").value);
  const pedInd = document.getElementById("pedInd").value;
  const justification = document.getElementById("pedJustification").value.trim();
  
  if (!w || w <= 0) {
    alert("Enter child weight.");
    return;
  }
  if (!pedInd) {
    alert("Select pediatric indication.");
    return;
  }
  if (pedInd === "override" && justification.length < 5) {
    alert("Clinician justification required for override.");
    return;
  }

  // Dose = 8 mg/kg, max 250 mg, then round to nearest 25 mg
  const rawDose = Math.min(8 * w, 250);
  const dose = round25(rawDose);

  // Duration
  let duration = "";
  if (pedInd === "anthrax") duration = "60 days";
  else if (pedInd === "plague") duration = "10–14 days";
  else duration = "Varies – override mode";

  // PK estimates (simple model: Vd=1.1 L/kg)
  const vd = 1.1 * w;
  const cl = (w * 0.06) + 1;
  const ke = cl / vd;
  const thalf = 0.693 / ke;

  const infusionH = 1;
  const R = dose / infusionH;
  const cmax = (R / (ke * vd)) * (1 - Math.exp(-ke * infusionH));
  const interval = 12;
  const cmin = cmax * Math.exp(-ke * (interval - infusionH));

  // Output
  document.getElementById("pedDoseOut").textContent = `${dose} mg (rounded to nearest 25 mg)`;
  document.getElementById("pedIntOut").textContent = "Every 12 hours (q12h)";
  document.getElementById("pedDurOut").textContent = duration;

  document.getElementById("pedVdOut").textContent = `${vd.toFixed(1)} L`;
  document.getElementById("pedClOut").textContent = `${cl.toFixed(2)} L/h`;
  document.getElementById("pedKeOut").textContent = `${ke.toFixed(3)} h⁻¹`;
  document.getElementById("pedThalfOut").textContent = `${thalf.toFixed(1)} h`;

  document.getElementById("pedCmaxOut").textContent = `${cmax.toFixed(1)} mg/L`;
  document.getElementById("pedCminOut").textContent = `${cmin.toFixed(2)} mg/L`;

  // Summary
  const summary = [];
  summary.push("Pediatric Levofloxacin Dosing Summary");
  summary.push("--------------------------------------------");
  summary.push(`Indication: ${pedInd}`);
  summary.push(`Weight: ${w} kg`);
  summary.push(`Dose: ${dose} mg q12h`);
  summary.push(`Duration: ${duration}`);
  if (pedInd === "override") {
    summary.push("");
    summary.push("OVERRIDE JUSTIFICATION:");
    summary.push(justification);
  }
  summary.push("");
  summary.push("Safety Note:");
  summary.push("Fluoroquinolones carry risk of musculoskeletal toxicity in children. Use only when benefits outweigh risks.");
  
  document.getElementById("pedSummaryText").textContent = summary.join("\n");
});

/* =================== Adult Logic Placeholder =================== */
document.getElementById("adultCalcBtn").addEventListener("click", () => {
  document.getElementById("adultOut").textContent =
    "Adult calculation placeholder (still active for age ≥16).";
});
</script>

</body>
</html>
